# 需求文档

## 1. 项目概述

### 1.1 项目名称
高纯石英矿石图像分类系统（用户认证与权限管理模块）

### 1.2 项目背景
本项目是一个企业级用户认证与权限管理系统，专注于五个角色的核心功能实现，为后续图像分类功能提供基础支撑。

### 1.3 项目目标
- 实现完整的用户认证系统（注册、登录、Token管理）
- 实现基于角色的权限控制（RBAC）
- 提供用户管理功能（创建、查看、删除用户）
- 确保系统安全性和可扩展性

## 2. 用户角色

### 2.1 普通用户（User）
- 可以注册账号
- 可以登录系统
- 可以查看个人信息
- 可以查看系统统计数据

### 2.2 管理员（Admin）
- 拥有普通用户的所有权限
- 可以创建新用户
- 可以查看所有用户列表
- 可以删除普通用户（不能删除管理员和自己）

## 3. 功能需求

### 3.1 用户注册（US-001）

#### 用户故事
作为新用户，我希望能够注册账号，以便使用系统。

#### 功能描述
- 用户可以通过填写表单注册新账号
- 注册信息包括：用户名、邮箱、密码、确认密码、姓名（可选）
- 注册用户默认为普通用户角色

#### 验收标准
- ✅ 用户可以成功注册账号
- ✅ 用户名和邮箱必须唯一
- ✅ 密码长度至少6个字符
- ✅ 密码和确认密码必须一致
- ✅ 邮箱格式必须正确
- ✅ 注册成功后跳转到登录页面

#### 用例
```
用例名称：用户注册
参与者：新用户
前置条件：用户未登录
主流程：
1. 用户访问注册页面
2. 用户填写注册表单（用户名、邮箱、密码、确认密码、姓名）
3. 系统验证表单数据
4. 系统检查用户名和邮箱是否已存在
5. 系统创建新用户（角色默认为普通用户）
6. 系统返回注册成功消息
7. 用户跳转到登录页面
异常流程：
- 3a. 表单验证失败：显示错误消息，用户修改后重新提交
- 4a. 用户名已存在：显示"用户名已存在"错误
- 4b. 邮箱已存在：显示"邮箱已被注册"错误
后置条件：新用户已创建，用户跳转到登录页面
```

### 3.2 用户登录（US-002）

#### 用户故事
作为已注册用户，我希望能够登录系统，以便访问系统功能。

#### 功能描述
- 用户可以通过用户名和密码登录
- 登录成功后获得访问令牌（JWT Token）
- Token存储在本地存储中

#### 验收标准
- ✅ 用户可以成功登录
- ✅ 错误密码无法登录
- ✅ 不存在的用户无法登录
- ✅ 已禁用用户无法登录
- ✅ 登录成功后跳转到首页
- ✅ Token有效期30分钟

#### 用例
```
用例名称：用户登录
参与者：已注册用户
前置条件：用户已注册账号
主流程：
1. 用户访问登录页面
2. 用户输入用户名和密码
3. 系统验证用户名和密码
4. 系统检查用户是否激活
5. 系统生成JWT Token
6. 系统返回Token
7. 前端保存Token到本地存储
8. 用户跳转到首页
异常流程：
- 3a. 用户名或密码错误：显示"用户名或密码错误"
- 4a. 用户已被禁用：显示"用户已被禁用"
后置条件：用户已登录，Token已保存
```

### 3.3 查看个人信息（US-003）

#### 用户故事
作为登录用户，我希望能够查看我的个人信息。

#### 功能描述
- 用户可以查看自己的用户信息
- 信息包括：用户名、邮箱、姓名、角色、状态

#### 验收标准
- ✅ 登录用户可以查看个人信息
- ✅ 未登录用户无法访问
- ✅ Token过期后自动跳转到登录页

### 3.4 创建用户（US-004）

#### 用户故事
作为管理员，我希望能够创建新用户，以便管理系统用户。

#### 功能描述
- 管理员可以创建新用户
- 可以指定用户角色（普通用户或管理员）
- 需要验证用户名和邮箱唯一性

#### 验收标准
- ✅ 管理员可以创建用户
- ✅ 普通用户无法创建用户
- ✅ 用户名和邮箱必须唯一
- ✅ 创建成功后刷新用户列表

#### 用例
```
用例名称：管理员创建用户
参与者：管理员
前置条件：管理员已登录
主流程：
1. 管理员访问用户管理页面
2. 管理员点击"创建用户"按钮
3. 系统显示创建用户对话框
4. 管理员填写用户信息（用户名、邮箱、密码、姓名、角色）
5. 系统验证表单数据
6. 系统检查用户名和邮箱是否已存在
7. 系统创建新用户
8. 系统返回创建成功消息
9. 系统刷新用户列表
异常流程：
- 5a. 表单验证失败：显示错误消息
- 6a. 用户名已存在：显示"用户名已存在"错误
- 6b. 邮箱已存在：显示"邮箱已存在"错误
后置条件：新用户已创建，用户列表已更新
```

### 3.5 查看用户列表（US-005）

#### 用户故事
作为管理员，我希望能够查看所有用户列表，以便管理用户。

#### 功能描述
- 管理员可以查看所有用户
- 显示用户基本信息：ID、用户名、邮箱、姓名、角色、状态、创建时间
- 支持分页（默认每页100条）

#### 验收标准
- ✅ 管理员可以查看用户列表
- ✅ 普通用户无法查看用户列表
- ✅ 列表显示所有用户信息
- ✅ 支持分页功能

### 3.6 删除用户（US-006）

#### 用户故事
作为管理员，我希望能够删除普通用户，以便管理用户账号。

#### 功能描述
- 管理员可以删除普通用户
- 不能删除管理员账号
- 不能删除自己的账号
- 删除前需要确认

#### 验收标准
- ✅ 管理员可以删除普通用户
- ✅ 管理员无法删除其他管理员
- ✅ 管理员无法删除自己
- ✅ 普通用户无法删除用户
- ✅ 删除前显示确认对话框
- ✅ 删除成功后刷新用户列表

#### 用例
```
用例名称：管理员删除用户
参与者：管理员
前置条件：管理员已登录，用户列表中有普通用户
主流程：
1. 管理员访问用户管理页面
2. 管理员在用户列表中点击"删除"按钮
3. 系统显示确认对话框
4. 管理员确认删除
5. 系统验证删除权限（不能删除管理员和自己）
6. 系统删除用户
7. 系统返回删除成功消息
8. 系统刷新用户列表
异常流程：
- 5a. 尝试删除管理员：显示"不能删除管理员账号"错误
- 5b. 尝试删除自己：显示"不能删除自己的账号"错误
- 5c. 用户不存在：显示"用户不存在"错误
后置条件：用户已删除，用户列表已更新
```

### 3.7 查看系统统计（US-007）

#### 用户故事
作为登录用户，我希望能够查看系统统计数据，以便了解系统使用情况。

#### 功能描述
- 所有登录用户可以查看系统统计
- 统计信息包括：总用户数、活跃用户数、管理员数量

#### 验收标准
- ✅ 登录用户可以查看统计数据
- ✅ 统计数据实时更新
- ✅ 数据准确性

## 4. 非功能需求

### 4.1 性能需求
- API响应时间 < 200ms
- 页面加载时间 < 2s
- 支持至少100并发用户

### 4.2 安全需求
- 密码使用bcrypt加密存储
- 使用JWT Token进行身份认证
- Token有效期30分钟
- 实现基于角色的权限控制（RBAC）
- 前端XSS防护（Vue 3自动转义）
- API接口权限验证

### 4.3 可用性需求
- 界面简洁易用
- 错误提示清晰明确
- 支持响应式设计

### 4.4 可维护性需求
- 代码结构清晰，模块化设计
- 完整的测试覆盖
- 完善的文档

## 5. 技术约束

### 5.1 后端技术栈
- Python 3.12
- FastAPI
- PostgreSQL
- SQLAlchemy ORM
- Alembic（数据库迁移）

### 5.2 前端技术栈
- Vue 3
- TypeScript
- Element Plus
- Pinia（状态管理）
- Vue Router
- Axios

### 5.3 开发工具
- Git（版本控制）
- Docker（容器化）
- GitHub Actions（CI/CD）

## 6. 验收标准

### 6.1 功能验收
- 所有功能需求已实现
- 所有测试用例通过
- 无严重缺陷

### 6.2 质量验收
- 代码覆盖率 ≥ 80%
- 通过所有代码质量检查
- 通过安全扫描

### 6.3 文档验收
- 需求文档完整
- API文档完整
- 部署文档完整
- 测试计划完整



